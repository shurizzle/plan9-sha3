static void
test_turboshake_256(void)
{
	static const uchar output0[64] = {
		74, 85, 91, 6, 236, 248, 241, 83, 140, 207, 92, 149, 21, 208, 208, 73, 112, 24, 21, 99, 166, 35, 129, 199, 240, 200, 7, 166, 209, 189, 158, 129, 151, 128, 75, 253, 226, 66, 139, 247, 41, 97, 235, 82, 180, 24, 156, 57, 28, 239, 111, 238, 102, 58, 60, 28, 231, 139, 136, 37, 91, 193, 172, 195
	};
	static const uchar output1[32] = {
		64, 34, 26, 215, 52, 243, 237, 193, 177, 6, 186, 213, 10, 114, 148, 147, 21, 179, 82, 186, 57, 173, 152, 181, 179, 194, 48, 17, 99, 173, 170, 208
	};
	static const uchar output2[64] = {
		74, 85, 91, 6, 236, 248, 241, 83, 140, 207, 92, 149, 21, 208, 208, 73, 112, 24, 21, 99, 166, 35, 129, 199, 240, 200, 7, 166, 209, 189, 158, 129, 151, 128, 75, 253, 226, 66, 139, 247, 41, 97, 235, 82, 180, 24, 156, 57, 28, 239, 111, 238, 102, 58, 60, 28, 231, 139, 136, 37, 91, 193, 172, 195
	};
	static const uchar output3[64] = {
		102, 211, 120, 223, 228, 233, 2, 172, 78, 183, 143, 124, 46, 90, 20, 240, 43, 193, 200, 73, 230, 33, 186, 230, 101, 121, 111, 179, 52, 110, 108, 121, 117, 112, 91, 185, 60, 0, 243, 202, 143, 131, 188, 164, 121, 240, 105, 119, 171, 58, 96, 243, 151, 150, 177, 54, 83, 138, 170, 232, 188, 172, 133, 68
	};
	static const uchar output4[64] = {
		197, 33, 116, 171, 242, 130, 149, 225, 93, 251, 55, 185, 70, 172, 54, 189, 58, 107, 204, 152, 192, 116, 252, 37, 25, 158, 5, 48, 66, 92, 197, 237, 212, 223, 212, 61, 195, 231, 230, 73, 26, 19, 23, 152, 48, 195, 199, 80, 201, 35, 126, 131, 253, 154, 63, 236, 70, 3, 255, 87, 228, 34, 46, 242
	};
	static const uchar output5[64] = {
		98, 165, 160, 191, 240, 100, 38, 215, 26, 122, 62, 158, 63, 47, 214, 226, 82, 255, 63, 193, 136, 166, 165, 54, 236, 164, 90, 73, 163, 67, 124, 179, 188, 58, 15, 129, 73, 200, 80, 230, 231, 244, 116, 122, 112, 98, 127, 210, 48, 48, 65, 198, 195, 54, 48, 249, 67, 173, 146, 248, 225, 255, 67, 144
	};
	static const uchar output6[64] = {
		82, 60, 6, 71, 24, 45, 137, 65, 240, 221, 92, 92, 10, 182, 45, 79, 194, 149, 97, 97, 83, 150, 187, 91, 154, 157, 235, 2, 43, 128, 197, 191, 45, 131, 163, 187, 54, 255, 192, 79, 172, 88, 207, 17, 73, 198, 109, 236, 74, 89, 82, 110, 81, 242, 149, 150, 216, 36, 66, 26, 75, 132, 180, 77
	};
	static const uchar output7[64] = {
		209, 20, 161, 193, 162, 8, 255, 5, 253, 73, 208, 158, 224, 53, 70, 93, 134, 84, 126, 186, 216, 233, 175, 79, 142, 135, 83, 112, 87, 61, 107, 123, 178, 10, 185, 96, 99, 90, 181, 116, 226, 33, 149, 239, 157, 23, 28, 154, 40, 1, 4, 75, 110, 46, 223, 39, 46, 35, 2, 85, 75, 58, 119, 201
	};
	static const uchar output8[64] = {
		30, 81, 52, 149, 214, 22, 152, 117, 181, 148, 83, 165, 148, 224, 138, 226, 113, 202, 32, 224, 86, 67, 200, 138, 152, 123, 91, 106, 180, 35, 237, 231, 36, 15, 52, 242, 179, 53, 250, 148, 188, 75, 13, 112, 227, 31, 182, 51, 176, 121, 132, 67, 49, 254, 164, 42, 156, 77, 121, 187, 140, 95, 158, 115
	};
	static const uchar output9[64] = {
		199, 73, 247, 251, 35, 100, 74, 2, 29, 53, 101, 61, 27, 253, 247, 71, 206, 206, 95, 151, 57, 249, 163, 68, 173, 22, 159, 16, 144, 108, 104, 23, 200, 238, 18, 120, 78, 66, 255, 87, 129, 78, 252, 28, 137, 135, 137, 213, 228, 21, 219, 73, 5, 46, 164, 58, 9, 144, 29, 122, 130, 162, 20, 92
	};
	static const uchar output10[64] = {
		255, 35, 220, 205, 98, 22, 143, 90, 68, 70, 82, 73, 168, 109, 193, 14, 138, 171, 75, 210, 106, 34, 222, 191, 35, 72, 2, 10, 131, 28, 219, 225, 44, 221, 54, 167, 221, 211, 30, 113, 192, 31, 124, 151, 160, 212, 195, 160, 204, 27, 33, 33, 230, 183, 206, 171, 56, 135, 164, 201, 165, 175, 139, 3
	};
	static const uchar data11[1] = {
		255
	};
	static const uchar output11[64] = {
		115, 141, 123, 78, 55, 209, 139, 127, 34, 173, 27, 83, 19, 227, 87, 227, 221, 125, 7, 5, 106, 38, 163, 3, 196, 51, 250, 53, 51, 69, 82, 128, 244, 245, 167, 212, 247, 0, 239, 180, 55, 254, 109, 40, 20, 5, 224, 123, 227, 42, 10, 151, 46, 34, 230, 58, 220, 27, 9, 13, 174, 254, 0, 75
	};
	static const uchar data12[3] = {
		255, 255, 255
	};
	static const uchar output12[64] = {
		229, 83, 140, 221, 40, 48, 42, 46, 129, 228, 31, 101, 253, 42, 64, 82, 1, 77, 12, 212, 99, 223, 103, 29, 30, 81, 10, 157, 149, 195, 125, 113, 53, 239, 39, 40, 67, 10, 158, 49, 112, 4, 248, 54, 201, 162, 56, 239, 53, 55, 2, 128, 208, 61, 206, 127, 6, 18, 240, 49, 91, 60, 191, 99
	};
	static const uchar data13[7] = {
		255, 255, 255, 255, 255, 255, 255
	};
	static const uchar output13[64] = {
		179, 139, 140, 21, 244, 166, 232, 12, 211, 236, 100, 95, 153, 159, 100, 152, 170, 215, 165, 154, 72, 156, 29, 238, 41, 112, 139, 79, 138, 89, 225, 36, 153, 169, 111, 137, 55, 34, 86, 254, 82, 43, 27, 151, 71, 42, 221, 115, 105, 21, 189, 77, 249, 59, 33, 255, 229, 151, 33, 126, 179, 194, 198, 217
	};
	static const struct { uchar separator; uchar *data; usize dlen; uchar *digest; usize len; usize truncate; } cases[14] = {
		{7, nil, 0, output0, 64, 0},
		{7, nil, 0, output1, 32, 10000},
		{7, nil, 0, output2, 64, 0},
		{7, nil, 17, output3, 64, 0},
		{7, nil, 289, output4, 64, 0},
		{7, nil, 4913, output5, 64, 0},
		{7, nil, 83521, output6, 64, 0},
		{7, nil, 1419857, output7, 64, 0},
		{7, nil, 24137569, output8, 64, 0},
		{11, nil, 0, output9, 64, 0},
		{6, nil, 0, output10, 64, 0},
		{6, data11, 1, output11, 64, 0},
		{6, data12, 3, output12, 64, 0},
		{6, data13, 7, output13, 64, 0},
	};

	uchar *digest = malloc(10032);
	for(usize i = 0; i < 14; ++i){
		uchar *buf = nil, *data = cases[i].data;
		if(cases[i].data == nil && cases[i].len != 0){
			buf = malloc(cases[i].dlen);
			if(buf == nil) sysfatal("%r");
			for(usize n = 0; n < cases[i].dlen; ++n)
				buf[n] = (uchar)(n % 0xFB);
			data = buf;
		}
		turboshake_256(data, cases[i].dlen, digest,
				cases[i].len + cases[i].truncate,
				turboshake_init(cases[i].separator, nil));
		if(memcmp(digest + cases[i].truncate, cases[i].digest, cases[i].len) != 0){
			fail = smprint("turboshake_256: case %uzd failed", i);
			free(digest);
			free(buf);
			return;
		}
		usize cmaxlen = 17;
		if(cases[i].dlen < 17) cmaxlen = cases[i].dlen;
		for(usize c = 1; c < cmaxlen; ++c){
			uchar *m = data;
			usize l = cases[i].dlen;
			DigestState *state = turboshake_init(cases[i].separator, nil);
			while(l >= c){
				turboshake_256(m, c, nil, 0, state);
				m += c;
				l -= c;
			}
			turboshake_256(m, l, digest, cases[i].len + cases[i].truncate, state);
			if(memcmp(digest + cases[i].truncate, cases[i].digest, cases[i].len) != 0){
				fail = smprint("turboshake_256: case %uzd failed", i);
				free(digest);
				free(buf);
				return;
			}
		}
		free(buf);
	}
	free(digest);
}
